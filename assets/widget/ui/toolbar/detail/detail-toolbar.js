/*! fetch-Module - v0.1.0 - 2015-04-23 12:23:41 */
!function(a,b){var c=a.DT||{};c.CONF={URL_LOGIN:"http://my.chinaso.com/",VSTAR_PATH:"http://my.chinaso.com/",URL_EXIT:"https://passport.chinaso.com/",URL_UNAME:"http://www.chinaso.com/",LOGIN_REG_TMPL:'<a id="jToolbarReg" class="register" href="{#registerUrl}">注册</a> | <a id="jToolbarLogin" href="{#loginUrl}" class="login">登录</a>',USER_TMPL:'<b></b><a href="javascript:;" class="account">{#uname}</a><i></i><div class="quit-box"><ul class="list51"><li><a target="_blank" href="http://wenda.chinaso.com/user/score.html">我的问答</a></li><li><a target="_blank" href="http://forum.chinaso.com/home.php?mod=spacecp&ac=profile">我的社区</a></li><li><a target="_blank" href="http://baike.chinaso.com/wiki/user-doccontri-create.html">我的百科</a></li><li class="last"><a id="jToolbarExit" class="quit last" href="javascript:void(0);">退出</a></li></ul></div>',NAC_TMPL:""},c.CONST={CID:"jToolbar",USERAREAID:"Id_loginBar",COOKIE_LOGIN:"chinasoticket_titlename",COOKIE_USER_NAME:"chinasoticket_titlename"},c.initialize=function(){this.build(),this.bindEvent()},c.build=function(){var b;if(c.Cookie.isLogin()){var d=c.Cookie.getCookie(c.CONST.COOKIE_USER_NAME,!0)||"";b=c.CONF.USER_TMPL.replace("{#uname}",d)}else{var e=a.location.href,f=c.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(e))),g=c.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(e)))+"#register";b=c.CONF.LOGIN_REG_TMPL.replace("{#loginUrl}",f).replace("{#registerUrl}",g)}document.getElementById(c.CONST.USERAREAID).innerHTML=c.CONF.NAC_TMPL+b},c.bindEvent=function(){$("#jToolbar .quit").on("click",function(){return $(this).PassportLogoutWhy({basePath:c.CONF.VSTAR_PATH,passurl:c.CONF.URL_EXIT+"logout/doLogout.htm",curUrl:encodeURIComponent(a.location.href)},{sucCb:function(){/^.*my.chinaso.com.*$/gi.test(location.host)&&(a.location.href=c.CONF.URL_UNAME),c.build()},errorCb:function(){c.build()}}),!1}),$("#jToolbar .more-link").on({mouseover:function(){c.Dom.hideBox(),$("#jToolbar .more-list").show()}}),$("#Id_loginBar").on("mouseover",function(){return c.Dom.hideBox(),$("#Id_loginBar .quit-box").show(),!1}),$(document).on("mouseover",function(a){$(a.target).closest(".quit-box").length||$("#Id_loginBar .quit-box").hide(),$(a.target).closest(".more-link").length||$("#jToolbar .more-list").hide()})},c.Dom=function(){return{hideBox:function(){$("#jToolbar .hide").not(function(){return $(this).parents(".hide").length?this:void 0}).hide()}}}(),c.Cookie=function(){return{isLogin:function(){var a=this.getCookie(c.CONST.COOKIE_LOGIN,!0);return null!==a?!0:!1},getCookie:function(a,b){var c,d=document.cookie,e=new RegExp("(^|)"+a+"=([^;]*)(;|$)");return c=d.match(e),c?b===!0?this.decodeStr(c[2]):c[2]:null},setCookie:function(a,b,c,d,e,f){var g=encodeURIComponent(a)+"="+encodeURIComponent(b),h=null,i=30;c instanceof Date?g+=";expires="+c.toGMTString():(h=new Date,h.setTime(h.getTime()+24*i*60*60*1e3),g+=";expires ="+h.toGMTString()),e&&(g+=";path="+e),d&&(g+=";domain="+d),f&&(g+=";secure"),document.cookie=g},decodeStr:function(a){var b,c="",d=a.length;for(b=0;d>b;b++){var e=a.charAt(b);if("+"==e)c+=" ";else if("%"==e){var f=a.substring(b+1,b+3);parseInt("0x"+f)>127?(c+=decodeURI("%"+a.substring(b+1,b+9)),b+=8):(c+=String.fromCharCode(parseInt("0x"+f)),b+=2)}else c+=e}return c},deleteCookie:function(a,b,c,d){var e=encodeURIComponent(a)+"="+encodeURIComponent("a"),f=new Date;f.setTime(f.getTime()-1e4),e+=";expires ="+f.toGMTString(),c&&(e+=";path="+c),b&&(e+=";domain="+b),d&&(e+=";secure"),document.cookie=e}}}(),c.initialize()}(window);