/*! fetch-Module - v0.1.0 - 2015-04-23 12:23:41 */
define("assets/widget/ui/toolbar/com-toolbar/toolbar",["assets/widget/com/jsonp","assets/utils/cookie","assets/utils/util","assets/utils/event/event","assets/utils/date/time","assets/widget/ui/toolbar/com-toolbar/weather","assets/utils/date/lunar-calendar","assets/widget/ui/easter/easter","jquery","assets/widget/ui/passport/passport","assets/widget/ui/set-home/set-home"],function(a,b,c){"use strict";function d(a){var b=this;b.defaults={CONST:{content:"",CID:"jToolbar",WID:"jToolbarWeather",EXITID:"jToolbarExit",UAREA:"jToolbarUser",COOKIE_LOGIN:"chinasoticket_titlename",COOKIE_USER_NAME:"chinasoticket_titlename"},CONF:{URL_UNAME:"http://www.chinaso.com/",URL_LOGIN:"http://my.chinaso.com/",URL_EXIT:"https://passport.chinaso.com/",URL_AJAX_EXIT:"https://passport.chinaso.com/logout/doLogout.htm",VSTAR_PATH:"http://my.chinaso.com/",URL_WEATHER:"http://www.chinaso.com/weather/query/"},timeArr:[]},g.extend(b.defaults,a),k.log()}var e=a("assets/widget/com/jsonp"),f=a("assets/utils/cookie"),g=a("assets/utils/util"),h=a("assets/utils/event/event"),i=a("assets/utils/date/time"),j=a("assets/widget/ui/toolbar/com-toolbar/weather")(),k=a("assets/widget/ui/easter/easter"),l=a("assets/utils/date/lunar-calendar")(),m=a("assets/widget/ui/passport/passport"),n=a("assets/widget/ui/set-home/set-home"),o=a("jquery");g.extend(d.prototype,{isLogin:function(){var a=this,b=f.get(a.defaults.CONST.COOKIE_LOGIN,!0);return null!==b?!0:!1},isHomePage:function(){return/^http:\/\/((www\.chinaso\.com\/index.+)|(chinaso\.com\/)|(my\.chinaso\.com.+)|(www\.chinaso\.com\/?))$/.test(location.href)?!0:!1},getUserState:function(){{var a,b,c,d,e,g=this;document.getElementById(g.defaults.CONST.UAREA)}c='<div class="weather_other"><div class="wo_box hide"><div class="wo_box_wrap"><div class="wo_search"><ul class="list17" id="wo_city_list"><li class="last" id="wo_last_input"><select class="input3" id="id_searchCity" placeholder="输入城市全拼/简拼"></select></li></ul><div class="clear"></div></div><div class="wo_tab"><a href="#" class="cur">热门城市</a><a href="#">省市</a></div><div class="wo_cont_box"><div class="wo_cont"><div class="h6"></div><ul class="list15" id="hotCity"></ul><div class="h6 clear"></div></div><div class="wo_cont hide"><div class="wo_sel_box"><select multiple="multiple" name="s_province" id="s_province"></select></div><div class="wo_sel_box"><select multiple="multiple" id="s_city" name="s_city"></select></div><div class="clear"></div></div></div><div class="wo_submit"><p><input type="button" class="btn3 mgr5" id="weatherSubmit" value="保存" /><input type="button" class="btn4" id="cancelSel" value="取消" /></p><span>您最多可同时选择3个城市</span></div></div><div class="wo_box_wrap hide"><div class="wo_detail_box"><ul class="list16"><li class="wo_color1"><h1></h1><h2></h2><h3></h3><h4></h4></li><li class="wo_color2"><h1></h1><h2></h2><h3></h3><h4></h4></li><li class="wo_color3 last"><h1></h1><h2></h2><h3></h3><h4></h4></li></ul><ul class="list16 hide"><li class="wo_color1"><h1></h1><h2></h2><h3></h3><h4></h4></li><li class="wo_color2"><h1></h1><h2></h2><h3></h3><h4></h4></li><li class="wo_color3 last"><h1></h1><h2></h2><h3></h3><h4></h4></li></ul><ul class="list16 hide"><li class="wo_color1"><h1></h1><h2></h2><h3></h3><h4></h4></li><li class="wo_color2"><h1></h1><h2></h2><h3></h3><h4></h4></li><li class="wo_color3 last"><h1></h1><h2></h2><h3></h3><h4></h4></li></ul></div><div class="wo_detail_text"><p id="wo_sel_day"><a href="#" class="cur">今天</a><i>|</i><a href="#">明天</a><i>|</i><a href="#">后天</a></p><strong id="resetCity">重新设定</strong></div></div></div></div>',d='<a href="http://m.chinaso.com/wsdownload.html" class="a_download" target="_blank">移动客户端</a>';var h='<a href="http://m.chinaso.com/wsdownload.html" class="a_download" target="_blank">移动客户端</a>';if(e="",g.isHomePage())if(g.isLogin())a=f.get(g.defaults.CONST.COOKIE_USER_NAME,!0)||"",b='<div id="jToolbarUser" class="account"><div class="skinOpen"><b class="head_pic"></b><a href="javascript:void(0)" class="a_user">'+a+'<i class="arrow_down"></i></a>'+h+'<span>|</span><a target="_blank" id="jToolbarHomepage" href="http://www.chinaso.com" >设国搜为主页</a></div><div class="quit_box hide"><ul class="list51"><li><a target="_blank" href="http://wenda.chinaso.com/user/score.html">我的问答</a></li><li><a target="_blank" href="http://forum.chinaso.com/home.php?mod=spacecp&ac=profile">我的论吧</a></li><li><a target="_blank" href="http://baike.chinaso.com/wiki/user-doccontri-create.html">我的百科</a></li><li class="last"><a id="jToolbarExit" href="javascript:void(0);">退出</a></li></ul></div></div><div class="fl top_data"><span id="jToolbarTime">'+g.setTimeArea()+'</span><a href="http://www.chinaso.com/search/pagesearch.htm?q=%E5%86%9C%E5%8E%86" target="_blank" class="date_lunar">'+g.getCurCNDDate()+'</a><i>|</i><span id="jToolbarWeather"></span></div>'+c;else{var i=window.location.href,j=g.defaults.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(i))),k=g.defaults.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(i)))+"#register";b='<div id="jToolbarUser" class="account"><div class="skinOpen"><a id="jToolbarLogin" href="'+j+'" class="a_login">登录</a><a id="jToolbarReg" href="'+k+'">注册</a><span>|</span>'+h+'<span>|</span><a target="_blank" id="jToolbarHomepage" href="http://www.chinaso.com">设国搜为主页</a></div></div><div class="fl top_data"><span id="jToolbarTime">'+g.setTimeArea()+'</span><a href="http://www.chinaso.com/search/pagesearch.htm?q=%E5%86%9C%E5%8E%86" target="_blank" class="date_lunar">'+g.getCurCNDDate()+'</a><i>|</i><span id="jToolbarWeather"></span></div>'+c}else if(g.isLogin())a=f.get(g.defaults.CONST.COOKIE_USER_NAME,!0)||"",b='<div id="jToolbarUser" class="account"><div class="skinOpen"><b class="head_pic"></b><a href="javascript:void(0)" class="a_user">'+a+'<i class="arrow_down"></i></a>'+d+'<span>|</span><a target="_blank" id="jToolbarHomepage" href="http://www.chinaso.com">设国搜为主页</a></div><div class="quit_box hide noindex_pos"><ul class="list51"><li><a target="_blank" href="http://wenda.chinaso.com/user/score.html">我的问答</a></li><li><a target="_blank" href="http://forum.chinaso.com/home.php?mod=spacecp&ac=profile">我的论吧</a></li><li><a target="_blank" href="http://baike.chinaso.com/wiki/user-doccontri-create.html">我的百科</a></li><li class="last"><a id="jToolbarExit" href="javascript:void(0);">退出</a></li></ul></div></div><div class="fl top_data">',b+='<span id="jToolbarTime">'+g.setTimeArea()+'</span><a target="_blank" href="http://www.chinaso.com/search/pagesearch.htm?q=%E5%86%9C%E5%8E%86" class="date_lunar">'+g.getCurCNDDate()+'</a><i>|</i><span id="jToolbarWeather"></span></div>'+c;else{var i=window.location.href,j=g.defaults.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(i))),k=g.defaults.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(i)))+"#register";b='<div id="jToolbarUser" class="account"><div class="skinOpen"><a id="jToolbarLogin" href="'+j+'" class="a_login">登录</a><a id="jToolbarReg" href="'+k+'">注册</a><span>|</span>'+d+'<span>|</span><a target="_blank" id="jToolbarHomepage" href="http://www.chinaso.com">设国搜为主页</a></div></div><div class="fl top_data">',b+='<span id="jToolbarTime">'+g.setTimeArea()+'</span><a target="_blank" href="http://www.chinaso.com/search/pagesearch.htm?q=%E5%86%9C%E5%8E%86" class="date_lunar">'+g.getCurCNDDate()+'</a><i>|</i><span id="jToolbarWeather"></span>',b+="</div>"+c}return b='<div class="top_con">'+b+"</div>"},encodeKeyword:function(a){for(var b=a.split("&"),c=0,d=b.length;d>c;c++)if(-1!=b[c].indexOf("q")){var e=b[c].substring(b[c].indexOf("q")),f=encodeURI(e);b[c]=b[c].replace(e,f)}return b.join("&")},updateUserState:function(){var a,b=this,c=document.getElementById(b.defaults.CONST.CID);c&&(a=document.getElementById(b.defaults.CONST.WID).innerHTML,c.innerHTML=b.getUserState(),document.getElementById(b.defaults.CONST.WID).innerHTML=a)},render:function(){var a,b=this,c=document.getElementById(b.defaults.CONST.CID),d=b.getUserState(),f='<div class="top" id="jToolbar">'+d+"</div>",g=new Date;void 0===typeof c?document.writeln(f):c.innerHTML=d,a=j.getWeatherData(),(a||+g.getTime()-a.expires>999)&&e("http://www.chinaso.com/weather/query/updateWheatherState?"+1e6*Math.random()+g.toTimeString())},logout:function(){e(this.defaults.CONF.URL_AJAX_EXIT,"BL.Com.Toolbar.updateUserState")},bindUserEvent:function(){var a=this,b=document.getElementById(a.defaults.CONST.EXITID);b&&h.addHandler(b,"click",a.logout)},unBindUserEvent:function(){var a=this,b=document.getElementById(a.defaults.CONST.EXITID);b&&h.removeHandler(b,"click",a.logout)},getCurDate:function(){var a=this;return a.defaults.timeArr[0]+" "+i.getDay()},getCurCNDDate:function(){var a=this;return a.defaults.timeArr[1]},setTimeArea:function(){var a=this,b=new Date;return a.defaults.timeArr[0]=i.formatting(b,"yyyy-mm-dd"),a.defaults.timeArr[1]=l.getLunarDay(b.getFullYear(),b.getMonth()-1,b.getDate()),a.getCurDate()},getWheather:function(a,b){var c,d=this;a=a||"北京",b=b||"updateWheatherState",c=b+"?city="+a,e(d.defaults.CONF.URL_WEATHER+c)},updateWheatherState:function(a){var b=this;return j.fillStorageWeatherData(a),b.formatWeatherData(a)},formatWeatherData:function(a){var b,c,d,e,f,g,h,i=this,j="";return a&&(b=a.cityExt,c=a.forcast,d=a.airQuality||{},d.aqi>=0&&d.aqi<=50?(e="you",f="优"):d.aqi>50&&d.aqi<=100?(e="liang",f="良"):d.aqi>100&&d.aqi<=150?(e="qingdu",f="轻度污染"):d.aqi>150&&d.aqi<=200?(e="zhongdu",f="中度污染"):d.aqi>200&&d.aqi<=300?(e="zhongdu2",f="重度污染"):d.aqi>300&&(e="yanzhong",f="严重污染"),f&&(j='空气质量：<em class="'+e+'">'+f+"</em></a>"),g='<a target="_blank" href="http://www.chinaso.com/search/pagesearch.htm?q=%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5">'+b.city+" ："+c.weathers[0].weather+" "+c.weathers[0].temp+'</a><a target="_blank" href="http://www.chinaso.com/search/pagesearch.htm?q=%E7%A9%BA%E6%B0%94%E8%B4%A8%E9%87%8F" class="air_quality">'+j,h=document.getElementById(i.defaults.CONST.WID),h&&(h.innerHTML=g)),g},initBaseEvent:function(){var a=this;o("#jToolbarHomepage").on("click",function(){n(this,"http://www.chinaso.com")}),o(".a_user").on("mouseover",function(){return o(".quit_box").css({left:this.offsetLeft}).show(),!1}),o(document).on("mouseover",function(a){0===o(a.target).closest(".quit_box").length&&o(".quit_box").hide()}),o("#jToolbarExit").on("click",function(){return m({basePath:a.defaults.CONF.VSTAR_PATH,passurl:a.defaults.CONF.URL_EXIT+"logout/doLogout.htm",curUrl:encodeURIComponent(window.location.href),sucCb:function(){/^.*my.chinaso.com.*$/gi.test(location.host)&&(window.location.href=a.defaults.CONF.URL_UNAME),a.updateUserState()},errorCb:function(){a.updateUserState()}}).passportLogout(),!1})},init:function(){var a=this;return a.render(),a.initBaseEvent(),this}});var p=new d;return window.updateWheatherState=function(a){p.updateWheatherState(a)},p.init(),p});