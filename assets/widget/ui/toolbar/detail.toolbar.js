!function(e,o){var t=e.DT||{};t.CONF={URL_LOGIN:"http://my.chinaso.com/",VSTAR_PATH:"http://my.chinaso.com/",URL_EXIT:"https://passport.chinaso.com/",URL_UNAME:"http://www.chinaso.com/",LOGIN_REG_TMPL:'<a id="jToolbarReg" class="register" href="{#registerUrl}">注册</a> | <a id="jToolbarLogin" href="{#loginUrl}" class="login">登录</a>',USER_TMPL:'<b></b><a href="javascript:;" class="account">{#uname}</a><i></i><div class="quit-box"><ul class="list51"><li><a target="_blank" href="http://wenda.chinaso.com/user/score.html">我的问答</a></li>'+'<li><a target="_blank" href="http://forum.chinaso.com/home.php?mod=spacecp&ac=profile">我的社区</a></li>'+'<li><a target="_blank" href="http://baike.chinaso.com/wiki/user-doccontri-create.html">我的百科</a></li>'+'<li class="last"><a id="jToolbarExit" class="quit last" href="javascript:void(0);">退出</a></li></ul></div>',NAC_TMPL:""},t.CONST={CID:"jToolbar",USERAREAID:"Id_loginBar",COOKIE_LOGIN:"chinasoticket_titlename",COOKIE_USER_NAME:"chinasoticket_titlename"};t.initialize=function(){this.build();this.bindEvent()};t.build=function(){var o;if(t.Cookie.isLogin()){var i=t.Cookie.getCookie(t.CONST.COOKIE_USER_NAME,true)||"";o=t.CONF.USER_TMPL.replace("{#uname}",i)}else{var n=e.location.href,r=t.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(n))),a=t.CONF.URL_LOGIN+"login.jsp?url=http://my.chinaso.com/ts.htm?u="+encodeURIComponent(encodeURIComponent(encodeURIComponent(n)))+"#register";o=t.CONF.LOGIN_REG_TMPL.replace("{#loginUrl}",r).replace("{#registerUrl}",a)}document.getElementById(t.CONST.USERAREAID).innerHTML=t.CONF.NAC_TMPL+o};t.bindEvent=function(){$("#jToolbar .quit").on("click",function(){$(this).PassportLogoutWhy({basePath:t.CONF.VSTAR_PATH,passurl:t.CONF.URL_EXIT+"logout/doLogout.htm",curUrl:encodeURIComponent(e.location.href)},{sucCb:function(){if(/^.*my.chinaso.com.*$/gi.test(location.host)){e.location.href=t.CONF.URL_UNAME}t.build()},errorCb:function(){t.build()}});return false});$("#jToolbar .more-link").on({mouseover:function(){t.Dom.hideBox();$("#jToolbar .more-list").show()}});$("#Id_loginBar").on("mouseover",function(){t.Dom.hideBox();$("#Id_loginBar .quit-box").show();return false});$(document).on("mouseover",function(e){if(!$(e.target).closest(".quit-box").length){$("#Id_loginBar .quit-box").hide()}if(!$(e.target).closest(".more-link").length){$("#jToolbar .more-list").hide()}})};t.Dom=function(){return{hideBox:function(){$("#jToolbar .hide").not(function(){if($(this).parents(".hide").length){return this}}).hide()}}}();t.Cookie=function(){return{isLogin:function(){var e=this.getCookie(t.CONST.COOKIE_LOGIN,true);if(e!==null){return true}else{return false}},getCookie:function(e,o){var t=document.cookie,i,n=new RegExp("(^|)"+e+"=([^;]*)(;|$)");i=t.match(n);if(i){if(o===true){return this.decodeStr(i[2])}else{return i[2]}}else{return null}},setCookie:function(e,o,t,i,n,r){var a=encodeURIComponent(e)+"="+encodeURIComponent(o),c=null,s=30;if(t instanceof Date){a+=";expires="+t.toGMTString()}else{c=new Date;c.setTime(c.getTime()+s*24*60*60*1e3);a+=";expires ="+c.toGMTString()}if(n){a+=";path="+n}if(i){a+=";domain="+i}if(r){a+=";secure"}document.cookie=a},decodeStr:function(e){var o="",t,i=e.length;for(t=0;t<i;t++){var n=e.charAt(t);if(n=="+"){o+=" "}else if(n=="%"){var r=e.substring(t+1,t+3);if(parseInt("0x"+r)>127){o+=decodeURI("%"+e.substring(t+1,t+9));t+=8}else{o+=String.fromCharCode(parseInt("0x"+r));t+=2}}else{o+=n}}return o},deleteCookie:function(e,o,t,i){var n=encodeURIComponent(e)+"="+encodeURIComponent("a");var r=new Date;r.setTime(r.getTime()-1e4);n+=";expires ="+r.toGMTString();if(t){n+=";path="+t}if(o){n+=";domain="+o}if(i){n+=";secure"}document.cookie=n}}}();t.initialize()}(window);